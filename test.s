AST_HEAD : 
<<<<<<< HEAD
=======
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = getchar, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(*uint8) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = gets, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = buffer, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION() | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = perror, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = str, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE() : 
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = printf, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = str, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = putchar, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = c, float_value = 0E+00 ]
				AST_DATATYPE(uint8) : [ int_value = 0, string_value = uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = puts, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = str, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = remove, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = filename, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = rename, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = oldname, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = newname, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = scanf, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = format_string, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = snprintf, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = outbuf, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
			AST_VARIABLE_DEFINITION(uint64) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = n, float_value = 0E+00 ]
				AST_DATATYPE(uint64) : [ int_value = 0, string_value = uint64, float_value = 0E+00 ]
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = str, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = sprintf, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = buffer, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = format_string, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = sscanf, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = buffer, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = format_string, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(*int8) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = tmpnam, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = str, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(*int8) : [ int_value = 0, string_value = *int8, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = vprintf, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = format, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = vscanf, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = format, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = vsprintf, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = target_string, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = format, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = vsnprintf, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = outbuf, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
			AST_VARIABLE_DEFINITION(uint64) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = n, float_value = 0E+00 ]
				AST_DATATYPE(uint64) : [ int_value = 0, string_value = uint64, float_value = 0E+00 ]
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = str, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = vsscanf, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = buffer, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
			AST_VARIABLE_DEFINITION(*uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = format, float_value = 0E+00 ]
				AST_DATATYPE(*uint8) : [ int_value = 0, string_value = *uint8, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = vswscanf, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint32) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = buffer, float_value = 0E+00 ]
				AST_DATATYPE(*uint32) : [ int_value = 0, string_value = *uint32, float_value = 0E+00 ]
			AST_VARIABLE_DEFINITION(*uint32) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = format, float_value = 0E+00 ]
				AST_DATATYPE(*uint32) : [ int_value = 0, string_value = *uint32, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
	AST_FUNCTION_DEFINITION(int32) | ASTO_FUNCTION_EXTERNAL : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = vwscanf, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
			AST_VARIABLE_DEFINITION(*uint32) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = format, float_value = 0E+00 ]
				AST_DATATYPE(*uint32) : [ int_value = 0, string_value = *uint32, float_value = 0E+00 ]
		AST_DATATYPE(int32) : [ int_value = 0, string_value = int32, float_value = 0E+00 ]
>>>>>>> master
	AST_FUNCTION_DEFINITION() : 
		AST_FUNCTION_DEFINITION_NAME() : [ int_value = 0, string_value = main, float_value = 0E+00 ]
		AST_FUNCTION_DEFINITION_ARGS() : 
		AST_DATATYPE() : 
		AST_BODY() | ASTO_BODY_FUNCTION : 
<<<<<<< HEAD
			AST_LITERAL(null) : [ int_value = 0, string_value = , float_value = 0E+00 ]
			AST_VARIABLE_DEFINITION(*uint64) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = ptr, float_value = 0E+00 ]
				AST_DATATYPE(*uint64) : [ int_value = 0, string_value = *uint64, float_value = 0E+00 ]
				AST_LITERAL(*uint64) : [ int_value = 0, string_value = , float_value = 0E+00 ]
			AST_VARIABLE_DEFINITION([]uint8) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = arr, float_value = 0E+00 ]
				AST_DATATYPE([]uint8) : [ int_value = 0, string_value = []uint8, float_value = 0E+00 ]
				AST_LITERAL([]uint8) : [ int_value = 0, string_value = , float_value = 0E+00 ]
			AST_VARIABLE_DEFINITION(string) : 
				AST_VARIABLE_DEFINITION_NAME() : [ int_value = 0, string_value = str, float_value = 0E+00 ]
				AST_DATATYPE(string) : [ int_value = 0, string_value = string, float_value = 0E+00 ]
				AST_LITERAL(string) : [ int_value = 0, string_value = , float_value = 0E+00 ]
panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x30 pc=0x4e91d7]

goroutine 1 [running]:
mycgo/back/codegen.GEN_store({0x0?, 0x0}, {{0x59eda0, 0xc0000263e0}, 0xfffffffffffffff8, {0x59ed30, 0xc000010030}, {0x0, 0x0}, 0x1})
	/home/lorenzo/Projects/mycgo/back/codegen/codegen_amd64.go:1392 +0x3d7
mycgo/back/codegen.GEN_move({0x0?, 0x0?}, {0x59ecf8?, 0xc000116338?})
	/home/lorenzo/Projects/mycgo/back/codegen/codegen_amd64.go:1424 +0x1b0
mycgo/back/codegen.Codegen(0xc0000663c0)
	/home/lorenzo/Projects/mycgo/back/codegen/codegen.go:429 +0xead
mycgo/back/codegen.Codegen(0xc000066280)
	/home/lorenzo/Projects/mycgo/back/codegen/codegen.go:147 +0x1ba
mycgo/back/codegen.Codegen(0xc0000660f0)
	/home/lorenzo/Projects/mycgo/back/codegen/codegen.go:147 +0x1ba
mycgo/back/codegen.Codegen(0xc0000660a0)
	/home/lorenzo/Projects/mycgo/back/codegen/codegen.go:147 +0x1ba
main.main()
	/home/lorenzo/Projects/mycgo/main/main.go:159 +0x9d8
=======
			AST_FUNCTION_CALL(int32) : [ int_value = 0, string_value = printf, float_value = 0E+00 ]
				AST_OP_DOT(*uint8) : [ int_value = 0, string_value = data, float_value = 0E+00 ]
					AST_LITERAL(static_string) : [ int_value = 0, string_value = hello!
, float_value = 0E+00 ]
					AST_VARIABLE_NAME(*uint8) : [ int_value = 0, string_value = data, float_value = 0E+00 ]
			AST_FUNCTION_CALL(int32) : [ int_value = 0, string_value = printf, float_value = 0E+00 ]
				AST_OP_DOT(*uint8) : [ int_value = 0, string_value = data, float_value = 0E+00 ]
					AST_LITERAL(static_string) : [ int_value = 0, string_value = yeah!
, float_value = 0E+00 ]
					AST_VARIABLE_NAME(*uint8) : [ int_value = 0, string_value = data, float_value = 0E+00 ]
.text




















.string "\0main"
.global main
main:
pushq %rbp

movq %rsp, %rbp

subq $240, %rsp







movq $.L1, %rdi


movq %rsp, %rax



movq $0, %rax


call printf

movl %eax, %ebx






movq $.L2, %rdi


movq %rsp, %rax



movq $0, %rax


call printf

movl %eax, %r12d





._main:
movq %rbp, %rsp

popq %rbp

ret



 
function_name:
	pushq %rbp
	movq %rsp, %rbp

	// skip null-termination
	decq %rdi
	decq %rdi

	f_name_loop:
	cmpb $0, (%rdi)
	je  f_name_loop_exit

	decq %rdi
	jmp f_name_loop

	f_name_loop_exit:
	incq %rdi
	movq %rdi, %rax

	movq %rbp, %rsp
	popq %rbp
	ret
	

.string "\0stack_trace"
.global stack_trace
stack_trace:
	pushq %rbp
	movq %rsp, %rbp

	stack_trace_loop:
	// check if i am at the bottom of the stack and exit 
	
	


	// call instruction address 
	movq 8(%rbp), %rbx
	
	// to get the address of the current function, we
	// read the call instruction:
	// let's assume the opcode is big 1 byte, and the operand (address) is 
	// big 4 bytes.

	// read the opcode
	movb -5(%rbx), %sil

	//op E8 means relative addressing
	cmpb $0xe8, %sil
	je stack_trace_relative
	
	jmp stack_trace_absolute
	stack_trace_relative:
	// read function address
	xorq %r12, %r12
	movl -4(%rbx), %r12d
	
	// add to caller address
	addl %ebx, %r12d

	movq %r12, %rdi
	call function_name

	movq %rax, %rsi
	movq $stack_trace_message, %rdi
	call printf
	jmp stack_trace_continue

	stack_trace_absolute:
	// read function address
	xorq %r12, %r12
	movl -4(%rbx), %r12d

	movq %r12, %rdi
	call function_name

	movq %rax, %rsi
	movq $stack_trace_message, %rdi
	call printf
	
	stack_trace_continue:
	// if function address is == main, we are at the end!
	cmpq $main, %r12
	je stack_trace_exit

	// base pointer of caller
	movq (%rbp), %rbp  
	jmp stack_trace_loop
	
	stack_trace_exit:
	movq %rbp, %rsp
	popq %rbp
	ret
	
 
.string "\0err_oob"
.global err_oob
err_oob:
	pushq %rbp
	movq %rsp, %rbp

	// rsi = index; rdx = length
	movq $err_oob_message, %rdi
	call printf

	call stack_trace
	call exit

.string "\0_mystart"
.global _mystart
_mystart:

	// rdi, rsi: args
	// (skip argc)
	leaq 8(%rsp), %rdi
	xorq %rsi, %rsi
	_mystart_args_loop:
	// if NULL end
	cmpq $0, (%rdi, %rsi, 8)
	je _mystart_args_loop_end
	incq %rsi
	jmp _mystart_args_loop
	_mystart_args_loop_end:

	// rdx, rcx: envs
	// (skip null)
	leaq 8(%rdi, %rsi, 8), %rdx
	xorq %rcx, %rcx
	_mystart_envs_loop:
	cmpq $0, (%rdx, %rcx, 8)
	je _mystart_envs_loop_end
	incq %rcx
	jmp _mystart_envs_loop
	_mystart_envs_loop_end:
	
	call main
	movq %rax, %rdi

	call exit


.data
























.L1: .byte 104, 101, 108, 108, 111, 33, 10, 0









.L2: .byte 121, 101, 97, 104, 33, 10, 0













err_oob_message: .string "runtime error: index %llu is out of boundaries, with length %llu.\n"
stack_trace_message: .string "at function %s\n"


>>>>>>> master
